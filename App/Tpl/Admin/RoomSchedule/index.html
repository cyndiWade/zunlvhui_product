<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!--> <html lang="en"> <!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
	<!-- 全局样式 -->	<include file="Public:top" />
	<!-- BEGIN PAGE LEVEL STYLES -->
	<link href="{$Think.const.APP_PATH}Public/media/css/fullcalendar.css" rel="stylesheet" />		<style type="text/css">		#event_box_hidden {			display:none;		}				.schedule_container span {			line-height:35px;		}</style>
</head>
<!-- END HEAD -->
<!-- BEGIN BODY -->
<body class="page-header-fixed">
	<include file="Public:header" />
	<!-- BEGIN CONTAINER -->   
	<div class="page-container row-fluid">
		<!-- 左侧导航 -->		<include file="Public:sidebar" />
		<!-- BEGIN PAGE -->
		<div class="page-content">
			<!-- BEGIN PAGE CONTAINER-->
			<div class="container-fluid">
				<!-- BEGIN PAGE HEADER-->
				<div class="row-fluid">
					<div class="span12">
						<!-- BEGIN PAGE TITLE & BREADCRUMB-->
						<h3 class="page-title">
							{$global_tpl_view.module_name}<small> {$global_tpl_view.action_name}</small>
						</h3>
						<!-- END PAGE TITLE & BREADCRUMB-->												<include file="Public:cars_menu" />
					</div>
				</div>
				<!-- END PAGE HEADER-->
				<!-- BEGIN PAGE CONTENT-->
				<div class="row-fluid">
					<div class="portlet box blue calendar">
						<div class="portlet-title">
							<div class="caption"><i class="icon-reorder"></i>{$global_tpl_view.title_name}</div>
						</div>
						<div class="portlet-body light-grey">
							<div class="row-fluid">
								<div class="span3 responsive" data-tablet="span12 fix-margin" data-desktop="span8">
									<!-- BEGIN DRAGGABLE EVENTS PORTLET-->    
									<!-- <h3 class="event-form-title">编辑日程</h3>-->
									<div id="external-events">
										<form class="inline-form">																						<div class="schedule_container">												<span>开始时间：</span>												<input type="hidden" name="hotel_room_id" value="{$html['hotel_room_id']}" readonly />												<input type="text" name="start_time" value="" class="m-wrap span7 wade_datetimepicker" data-date-format="yyyy-mm-dd" readonly  />											</div>																						<div class="schedule_container">												<span>结束时间：</span>												<input type="text" name="over_time" value="" class="m-wrap span7 wade_datetimepicker" readonly />											</div>											<div class="schedule_container">
												<span>现付价格：</span>												<input type="text" name="spot_payment" value="" class="m-wrap span7"/>											</div>																						<div class="schedule_container">												<span>到付价格：</span>												<input type="text" name="prepay" value="" class="m-wrap span7"  />											</div>																						<a href="javascript:;" id="event_add" class="btn green">提交</a>
										</form>
										<hr />													<div id="event_box_hidden">
										<div id="event_box">
										</div>
										<label for="drop-remove">
										<input type="checkbox" id="drop-remove" />remove after drop                         
										</label>										</div>
										<hr class="visible-phone" />
									</div>
									<!-- END DRAGGABLE EVENTS PORTLET-->            
								</div>
								<div class="span9">
									<div id="calendar" class="has-toolbar"></div>
								</div>
							</div>
							<!-- END CALENDAR PORTLET-->
						</div>
					</div>
				</div>
				<!-- END PAGE CONTENT-->
			</div>
			<!-- END PAGE CONTAINER--> 
		</div>
		<!-- END PAGE -->    
	</div>
	<!-- END CONTAINER -->
	<!-- 页脚 -->	<include file="Public:foot" />
	<!-- 核心插件 -->	<include file="Public:bottom" />	
	<!-- BEGIN PAGE LEVEL PLUGINS -->
	<script src="{$Think.const.APP_PATH}Public/media/js/fullcalendar.min.js"></script>
	<!-- END PAGE LEVEL PLUGINS -->
	<!-- BEGIN PAGE LEVEL SCRIPTS -->
	<script src="{$Think.const.APP_PATH}Public/media/js/app.js"></script>
<!--	<script src="{$Think.const.APP_PATH}Public/media/js/calendar.js"></script>     -->
	<script type="text/jscript">
jQuery(document).ready(function() {       
// initiate layout and pluginsApp.init();var Calendar = function () {    return {        //main function to initiate the module        init: function () {            App.addResponsiveHandler(function () {                Calendar.initCalendar();            });            $('.page-sidebar .sidebar-toggler').click(function () {                Calendar.initCalendar();            });            Calendar.initCalendar();        },        initCalendar: function () {            if (!jQuery().fullCalendar) {                return;            }			var calendar = $('#calendar');            var date = new Date();            var d = date.getDate();            var m = date.getMonth();            var y = date.getFullYear();            var h = {};						/* 导航样式容错 */            if (App.isRTL()) {                 if (calendar.parents(".portlet").width() <= 720) {                    calendar.addClass("mobile");                    h = {                        right: 'title, prev, next',                        center: '',                        right: 'prev,next,today,agendaDay,agendaWeek,month'                    };                } else {                    calendar.removeClass("mobile");                    h = {                        right: 'title',                        center: '',                        left: 'prev,next,today,agendaDay,agendaWeek,month'                    };                }                            } else {                 if (calendar.parents(".portlet").width() <= 720) {                    calendar.addClass("mobile");                    h = {                        left: 'title, prev, next',                        center: '',                        right: 'prev,next,today,agendaDay,agendaWeek,month'                    };                } else {                    calendar.removeClass("mobile");                    h = {                        left: 'title',                        center: '',                        right: 'prev,next,today,agendaDay,agendaWeek,month'                    };                }            }           			            var initDrag = function (el) {                // create an Event Object (http://arshaw.com/fullcalendar/docs/event_data/Event_Object/)                // it doesn't need to have a start or end                var eventObject = {                    title: $.trim(el.text()) // use the element's text as the event title                };                // store the Event Object in the DOM element so we can get to it later                el.data('eventObject', eventObject);                // make the event draggable using jQuery UI                el.draggable({                    zIndex: 999,                    revert: true, // will cause the event to go back to its                    revertDuration: 0 //  original position after the drag                });            }           						/* 添加日程执行的函数  */            var addEvent = function (title) {                title = title.length == 0 ? "Untitled Event" : title;                var html = $('<div class="external-event label">' + title + '</div>');                jQuery('#event_box').append(html);                initDrag(html);            }            $('#external-events div.external-event').each(function () {                initDrag($(this))            });					//日历控件			var wade_datetimepicker = function () {				var options = {				    format: 'yyyy-mm-dd',					language:  'zh-CN',			        weekStart: 1,			        todayBtn:  1,					autoclose: 1,					todayHighlight: 1,					startView: 2,					forceParse: 0,			        showMeridian:1,					 todayBtn:1,					forceParse: 0,					minView: 2,				};				$('.wade_datetimepicker').datetimepicker(options);			}();					/* wade -- 自定义新日程到日历中 */			var add_schedule = function (title) {									/* 数据采集与验证 */					var arr_input = $('.schedule_container').find('input');					var check_result = true;					var post_data = {};										arr_input.each(function () {						var _this = $(this);						if (_this.val() == '') {							alert('不得为空！');							_this.focus();							check_result = false;							return false;						} else {							post_data[_this.attr('name')] = _this.val();						}					});					//	console.log(post_data);				//return false;					//日期验证					if (fomat_date(post_data.start_time) > fomat_date(post_data.over_time) ) {						alert('开始日期不得大于结束日期');						check_result = false;					}					//现付价格验证					if (post_data.spot_payment.match(/^[1-9][0-9]+$/gim) == undefined) {						alert('价格只能是数字');						check_result = false;					}					//到付					if (post_data.prepay.match(/^[1-9][0-9]+$/gim) == undefined)  {						alert('价格只能是数字');						check_result = false;					}										if (check_result == false)  return false;						/* 添加数据 */									var result = ajax_post_setup('?s=/Admin/RoomSchedule/Ajax_room_schedule_edit',post_data);					if (result == false) {						alert('服务器连接超时');						return false;					} else if (result.status == 0) {						alert(result.msg);					} else {						alert(result.msg);						return false;					}					//console.log(result);					/* 日程写入到日历中 */                    var copiedEventObject =  {};					copiedEventObject.id = result.data.id;					copiedEventObject.title = post_data.title;					copiedEventObject.start = post_data.start_schedule_time;					copiedEventObject.end = post_data.over_schedule_time;					copiedEventObject.backgroundColor = App.getLayoutColorCode('red');                    copiedEventObject.allDay = false;                    //添加到日历中                    calendar.fullCalendar('renderEvent', copiedEventObject, true);			};									/* 点击添加新的日程 */            $('#event_add').unbind('click').click(function () {			                var title = $('#event_title').val();				add_schedule(title);				              //  addEvent(title);            });						            calendar.fullCalendar('destroy'); // destroy the calendar            calendar.fullCalendar({ //re-initialize the calendar           	//	 contentHeight: 1024,	        	    monthNames: ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"],  	       	 	monthNamesShort: ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"],  	         	dayNames: ["周日", "周一", "周二", "周三", "周四", "周五", "周六"],  	         	dayNamesShort: ["周日", "周一", "周二", "周三", "周四", "周五", "周六"],  	        	today: ["今天"],  	       		buttonText: {  	        		today: '今天',  	     			month: '月',  	  			    week: '周',  	   				day: '日'				},				defaultView:'month',		//默认显示的视图				titleFormat:{				    month: 'yyyy-MM',                            				    week: "{yyyy}-MM", // Sep 7 - 13 2009				    day: 'yyyy-MM-dd dddd'               				},				header: h,				firstDay:1,	//Sunday=0, Monday=1, Tuesday=2, etc. 设置每个星期第一天是				axisFormat:'HH(:mm)',	//week的左边事件		axisFormat:'h(:mm)tt',				timeFormat :'HH:mm{ - HH:mm}',		//日程时间格式	timeFormat :''h:mm{ - h:mm}',                slotMinutes: 5,												/* 加载以后日程数据 */				events : function (start, end, callback) {					var hotel_room_id = $('input[name=hotel_room_id]').val();					var result = ajax_post_setup('?s=/Admin/RoomSchedule/AJAX_Get_Schedule',{'hotel_room_id':hotel_room_id});					var event_data = [];					if (result.status == 0) {						for (var obj in result.data) {							event_data.push({								id : result.data[obj].id,			                	title :123,			                	start: result.data[obj].day,							//	end : result.data[obj].over_schedule_time,							//	backgroundColor:App.getLayoutColorCode('red'),								allDay: false,			                });						}							//日程写入到日历中	                	callback(event_data);					}					 				},				/* 删除日程 */				eventClick:function( event, jsEvent, view ) { 									if (confirm('确定要删除吗？') == true) {						var id = event.id;						var result = ajax_post_setup('?s=/Admin/CarsSchedule/AJAX_DEL_Schedule',{'id':id});						if (result == false) {							alert('服务器连接超时');							return false;						} else if (result.status == 0) {							alert(result.msg);							calendar.fullCalendar('removeEvents', [id]);						} else {							alert(result.msg);							return false;						}					};									},				            });        }    };}();
		  Calendar.init();
});
</script>


<!-- END BODY -->
</html>